<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `/home/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/neon-0.9.1/src/context/mod.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>mod.rs - source</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings"></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../neon/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img src="../../../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img src="../../../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
</pre><pre class="rust">
<span class="doccomment">//! Provides runtime access to the JavaScript engine.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! An _execution context_ represents the current state of a thread of execution in the</span>
<span class="doccomment">//! JavaScript engine. Internally, it tracks things like the set of pending function calls,</span>
<span class="doccomment">//! whether the engine is currently throwing an exception or not, and whether the engine is</span>
<span class="doccomment">//! in the process of shutting down. The context uses this internal state to manage what</span>
<span class="doccomment">//! operations are safely available and when.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! The [`Context`](Context) trait provides an abstract interface to the JavaScript</span>
<span class="doccomment">//! execution context. All interaction with the JavaScript engine in Neon code is mediated</span>
<span class="doccomment">//! through instances of this trait.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! One particularly useful context type is [`CallContext`](CallContext), which is passed</span>
<span class="doccomment">//! to all Neon functions as their initial execution context (or [`FunctionContext`](FunctionContext),</span>
<span class="doccomment">//! a convenient shorthand for `CallContext&lt;JsObject&gt;`):</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! # use neon::prelude::*;</span>
<span class="doccomment">//! fn hello(mut cx: FunctionContext) -&gt; JsResult&lt;JsString&gt; {</span>
<span class="doccomment">//!     Ok(cx.string(&quot;hello Neon&quot;))</span>
<span class="doccomment">//! }</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Another important context type is [`ModuleContext`](ModuleContext), which is provided</span>
<span class="doccomment">//! to a Neon module&#39;s [`main`](crate::main) function to enable sharing Neon functions back</span>
<span class="doccomment">//! with JavaScript:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! # #[cfg(feature = &quot;neon-macros&quot;)] {</span>
<span class="doccomment">//! # use neon::prelude::*;</span>
<span class="doccomment">//! # fn hello(_: FunctionContext) -&gt; JsResult&lt;JsValue&gt; { todo!() }</span>
<span class="doccomment">//! #[neon::main]</span>
<span class="doccomment">//! fn main(mut cx: ModuleContext) -&gt; NeonResult&lt;()&gt; {</span>
<span class="doccomment">//!     cx.export_function(&quot;hello&quot;, hello)?;</span>
<span class="doccomment">//!     Ok(())</span>
<span class="doccomment">//! }</span>
<span class="doccomment">//! # }</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Memory Management</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Because contexts represent the engine at a point in time, they are associated with a</span>
<span class="doccomment">//! [_lifetime_][lifetime], which limits how long Rust code is allowed to access them. This</span>
<span class="doccomment">//! is also used to determine the lifetime of [`Handle`](crate::handle::Handle)s, which</span>
<span class="doccomment">//! provide safe references to JavaScript memory managed by the engine&#39;s garbage collector.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! For example, we can</span>
<span class="doccomment">//! write a simple string scanner that counts whitespace in a JavaScript string and</span>
<span class="doccomment">//! returns a [`JsNumber`](crate::types::JsNumber):</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! # #[cfg(feature = &quot;napi-1&quot;)] {</span>
<span class="doccomment">//! # use neon::prelude::*;</span>
<span class="doccomment">//! fn count_whitespace(mut cx: FunctionContext) -&gt; JsResult&lt;JsNumber&gt; {</span>
<span class="doccomment">//!     let s: Handle&lt;JsString&gt; = cx.argument(0)?;</span>
<span class="doccomment">//!     let contents = s.value(&amp;mut cx);</span>
<span class="doccomment">//!     let count = contents</span>
<span class="doccomment">//!         .chars()                       // iterate over the characters</span>
<span class="doccomment">//!         .filter(|c| c.is_whitespace()) // select the whitespace chars</span>
<span class="doccomment">//!         .count();                      // count the resulting chars</span>
<span class="doccomment">//!     Ok(cx.number(count as f64))</span>
<span class="doccomment">//! }</span>
<span class="doccomment">//! # }</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! In this example, `s` is assigned a handle to a string, which ensures that the string</span>
<span class="doccomment">//! is _kept alive_ (i.e., prevented from having its storage reclaimed by the JavaScript</span>
<span class="doccomment">//! engine&#39;s garbage collector) for the duration of the `count_whitespace` function. This</span>
<span class="doccomment">//! is how Neon takes advantage of Rust&#39;s type system to allow your Rust code to safely</span>
<span class="doccomment">//! interact with JavaScript values.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ### Temporary Scopes</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Sometimes it can be useful to limit the scope of a handle&#39;s lifetime, to allow the</span>
<span class="doccomment">//! engine to reclaim memory sooner. This can be important when, for example, an expensive inner loop generates</span>
<span class="doccomment">//! temporary JavaScript values that are only needed inside the loop. In these cases,</span>
<span class="doccomment">//! the [`execute_scoped`](Context::execute_scoped) and [`compute_scoped`](Context::compute_scoped)</span>
<span class="doccomment">//! methods allow you to create temporary contexts in order to allocate temporary</span>
<span class="doccomment">//! handles.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! For example, to extract the elements of a JavaScript [iterator][iterator] from Rust,</span>
<span class="doccomment">//! a Neon function has to work with several temporary handles on each pass through</span>
<span class="doccomment">//! the loop:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! # #[cfg(feature = &quot;napi-1&quot;)] {</span>
<span class="doccomment">//! # use neon::prelude::*;</span>
<span class="doccomment">//! # fn iterate(mut cx: FunctionContext) -&gt; JsResult&lt;JsUndefined&gt; {</span>
<span class="doccomment">//!     let iterator = cx.argument::&lt;JsObject&gt;(0)?;         // iterator object</span>
<span class="doccomment">//!     let next = iterator.get(&amp;mut cx, &quot;next&quot;)?           // iterator&#39;s `next` method</span>
<span class="doccomment">//!         .downcast_or_throw::&lt;JsFunction, _&gt;(&amp;mut cx)?;</span>
<span class="doccomment">//!     let mut numbers = vec![];                           // results vector</span>
<span class="doccomment">//!     let mut done = false;                               // loop controller</span>
<span class="doccomment">//!</span>
<span class="doccomment">//!     while !done {</span>
<span class="doccomment">//!         done = cx.execute_scoped(|mut cx| {                   // temporary scope</span>
<span class="doccomment">//!             let args: Vec&lt;Handle&lt;JsValue&gt;&gt; = vec![];</span>
<span class="doccomment">//!             let obj = next.call(&amp;mut cx, iterator, args)?     // temporary object</span>
<span class="doccomment">//!                 .downcast_or_throw::&lt;JsObject, _&gt;(&amp;mut cx)?;</span>
<span class="doccomment">//!             let number = obj.get(&amp;mut cx, &quot;value&quot;)?           // temporary number</span>
<span class="doccomment">//!                 .downcast_or_throw::&lt;JsNumber, _&gt;(&amp;mut cx)?</span>
<span class="doccomment">//!                 .value(&amp;mut cx);</span>
<span class="doccomment">//!             numbers.push(number);</span>
<span class="doccomment">//!             Ok(obj.get(&amp;mut cx, &quot;done&quot;)?                      // temporary boolean</span>
<span class="doccomment">//!                 .downcast_or_throw::&lt;JsBoolean, _&gt;(&amp;mut cx)?</span>
<span class="doccomment">//!                 .value(&amp;mut cx))</span>
<span class="doccomment">//!         })?;</span>
<span class="doccomment">//!     }</span>
<span class="doccomment">//! #   Ok(cx.undefined())</span>
<span class="doccomment">//! # }</span>
<span class="doccomment">//! # }</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! The temporary scope ensures that the temporary values are only kept alive</span>
<span class="doccomment">//! during a single pass through the loop, since the temporary context is</span>
<span class="doccomment">//! discarded (and all of its handles released) on the inside of the loop.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Throwing Exceptions</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! When a Neon API causes a JavaScript exception to be thrown, it returns an</span>
<span class="doccomment">//! [`Err`](std::result::Result::Err) result, indicating that the thread associated</span>
<span class="doccomment">//! with the context is now throwing. This allows Rust code to perform any</span>
<span class="doccomment">//! cleanup before returning, but with an important restriction:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! &gt; **While a JavaScript thread is throwing, its context cannot be used.**</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Unless otherwise documented, any Neon API that uses a context (as `self` or as</span>
<span class="doccomment">//! a parameter) immediately panics if called while the context&#39;s thread is throwing.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Typically, Neon code can manage JavaScript exceptions correctly and conveniently</span>
<span class="doccomment">//! by using Rust&#39;s [question mark (`?`)][question-mark] operator. This ensures that</span>
<span class="doccomment">//! Rust code &quot;short-circuits&quot; when an exception is thrown and returns back to</span>
<span class="doccomment">//! JavaScript without calling any throwing APIs.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Alternatively, to invoke a Neon API and catch any JavaScript exceptions, use the</span>
<span class="doccomment">//! [`Context::try_catch`](Context::try_catch) method, which catches any thrown</span>
<span class="doccomment">//! exception and restores the context to non-throwing state.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## See also</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! 1. Ecma International. [Execution contexts](https://tc39.es/ecma262/#sec-execution-contexts), _ECMAScript Language Specification_.</span>
<span class="doccomment">//! 2. Madhavan Nagarajan. [What is the Execution Context and Stack in JavaScript?](https://medium.com/@itIsMadhavan/what-is-the-execution-context-stack-in-javascript-e169812e851a)</span>
<span class="doccomment">//! 3. Rupesh Mishra. [Execution context, Scope chain and JavaScript internals](https://medium.com/@happymishra66/execution-context-in-javascript-319dd72e8e2c).</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! [lifetime]: https://doc.rust-lang.org/book/ch10-00-generics.html</span>
<span class="doccomment">//! [iterator]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators</span>
<span class="doccomment">//! [question-mark]: https://doc.rust-lang.org/edition-guide/rust-2018/error-handling-and-panics/the-question-mark-operator-for-easier-error-handling.html</span>

<span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">mod</span> <span class="ident">internal</span>;

<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::borrow::internal::Ledger</span>;
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::borrow</span>::{<span class="ident">Borrow</span>, <span class="ident">BorrowMut</span>, <span class="ident">Ref</span>, <span class="ident">RefMut</span>};
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::context::internal::Env</span>;
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-4&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;channel-api&quot;</span>))]</span>
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::event::Channel</span>;
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::handle</span>::{<span class="ident">Handle</span>, <span class="ident">Managed</span>};
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-6&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;channel-api&quot;</span>))]</span>
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::lifecycle::InstanceData</span>;
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::object::class::Class</span>;
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::object</span>::{<span class="ident">Object</span>, <span class="ident">This</span>};
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::result</span>::{<span class="ident">JsResult</span>, <span class="ident">NeonResult</span>, <span class="ident">Throw</span>};
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::types::binary</span>::{<span class="ident">JsArrayBuffer</span>, <span class="ident">JsBuffer</span>};
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::types::boxed</span>::{<span class="ident">Finalize</span>, <span class="ident">JsBox</span>};
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-5&quot;</span>)]</span>
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::types::date</span>::{<span class="ident">DateError</span>, <span class="ident">JsDate</span>};
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::types::error::JsError</span>;
<span class="kw">use</span> <span class="kw">crate</span><span class="ident">::types</span>::{
    <span class="ident">JsArray</span>, <span class="ident">JsBoolean</span>, <span class="ident">JsFunction</span>, <span class="ident">JsNull</span>, <span class="ident">JsNumber</span>, <span class="ident">JsObject</span>, <span class="ident">JsString</span>, <span class="ident">JsUndefined</span>, <span class="ident">JsValue</span>,
    <span class="ident">StringResult</span>, <span class="ident">Value</span>,
};
<span class="kw">use</span> <span class="ident">neon_runtime</span>;
<span class="kw">use</span> <span class="ident">neon_runtime::raw</span>;
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
<span class="kw">use</span> <span class="ident">smallvec::SmallVec</span>;
<span class="kw">use</span> <span class="ident">std</span>;
<span class="kw">use</span> <span class="ident">std::cell::RefCell</span>;
<span class="kw">use</span> <span class="ident">std::convert::Into</span>;
<span class="kw">use</span> <span class="ident">std::marker::PhantomData</span>;
<span class="kw">use</span> <span class="ident">std::os::raw::c_void</span>;
<span class="kw">use</span> <span class="ident">std::panic::UnwindSafe</span>;

<span class="kw">use</span> <span class="self">self</span><span class="ident">::internal</span>::{<span class="ident">ContextInternal</span>, <span class="ident">Scope</span>, <span class="ident">ScopeMetadata</span>};

<span class="attribute">#[<span class="ident">repr</span>(<span class="ident">C</span>)]</span>
<span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">struct</span> <span class="ident">CallbackInfo</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="ident">info</span>: <span class="ident">raw::FunctionCallbackInfo</span>,
    <span class="ident">_lifetime</span>: <span class="ident">PhantomData</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> <span class="ident">raw::FunctionCallbackInfo</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span> <span class="ident">CallbackInfo</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span> {
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">data</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">env</span>: <span class="ident">Env</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">*</span><span class="kw-2">mut</span> <span class="ident">c_void</span> {
        <span class="kw">unsafe</span> {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">raw_data</span>: <span class="kw-2">*</span><span class="kw-2">mut</span> <span class="ident">c_void</span> <span class="op">=</span> <span class="ident">std::mem::zeroed</span>();
            <span class="ident">neon_runtime::call::data</span>(<span class="ident">env</span>.<span class="ident">to_raw</span>(), <span class="self">self</span>.<span class="ident">info</span>, <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">raw_data</span>);
            <span class="ident">raw_data</span>
        }
    }

    <span class="kw">pub</span> <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">with_cx</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">This</span>, <span class="ident">U</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">U</span><span class="op">&gt;</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">env</span>: <span class="ident">Env</span>,
        <span class="ident">f</span>: <span class="ident">F</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">U</span> {
        <span class="ident">CallContext</span>::<span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="ident">::with</span>(<span class="ident">env</span>, <span class="self">self</span>, <span class="ident">f</span>)
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">set_return</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">Value</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">value</span>: <span class="ident">Handle</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>) {
        <span class="kw">unsafe</span> { <span class="ident">neon_runtime::call::set_return</span>(<span class="self">self</span>.<span class="ident">info</span>, <span class="ident">value</span>.<span class="ident">to_raw</span>()) }
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
    <span class="kw">fn</span> <span class="ident">kind</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">CallKind</span> {
        <span class="kw">if</span> <span class="kw">unsafe</span> { <span class="ident">neon_runtime::call::is_construct</span>(<span class="ident">std::mem::transmute</span>(<span class="self">self</span>)) } {
            <span class="ident">CallKind::Construct</span>
        } <span class="kw">else</span> {
            <span class="ident">CallKind::Call</span>
        }
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
    <span class="kw">fn</span> <span class="ident">kind</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="ident">C</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">CallKind</span> {
        <span class="kw">if</span> <span class="kw">unsafe</span> { <span class="ident">neon_runtime::call::is_construct</span>(<span class="ident">cx</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(), <span class="self">self</span>.<span class="ident">info</span>) } {
            <span class="ident">CallKind::Construct</span>
        } <span class="kw">else</span> {
            <span class="ident">CallKind::Call</span>
        }
    }

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">len</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="ident">C</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">i32</span> {
        <span class="kw">unsafe</span> { <span class="ident">neon_runtime::call::len</span>(<span class="ident">cx</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(), <span class="self">self</span>.<span class="ident">info</span>) }
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">C</span>, <span class="ident">i</span>: <span class="ident">i32</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">JsValue</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="kw">if</span> <span class="ident">i</span> <span class="op">&lt;</span> <span class="number">0</span> <span class="op">|</span><span class="op">|</span> <span class="ident">i</span> <span class="op">&gt;</span><span class="op">=</span> <span class="self">self</span>.<span class="ident">len</span>(<span class="ident">cx</span>) {
            <span class="kw">return</span> <span class="prelude-val">None</span>;
        }
        <span class="kw">unsafe</span> {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">local</span>: <span class="ident">raw::Local</span> <span class="op">=</span> <span class="ident">std::mem::zeroed</span>();
            <span class="ident">neon_runtime::call::get</span>(<span class="ident">cx</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(), <span class="self">self</span>.<span class="ident">info</span>, <span class="ident">i</span>, <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">local</span>);
            <span class="prelude-val">Some</span>(<span class="ident">Handle::new_internal</span>(<span class="ident">JsValue::from_raw</span>(<span class="ident">cx</span>.<span class="ident">env</span>(), <span class="ident">local</span>)))
        }
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">argv</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">C</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">SmallVec</span><span class="op">&lt;</span>[<span class="ident">raw::Local</span>; <span class="number">8</span>]<span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="ident">neon_runtime::call::argv</span>(<span class="ident">cx</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(), <span class="self">self</span>.<span class="ident">info</span>) }
    }

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">this</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">C</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">raw::Local</span> {
        <span class="kw">let</span> <span class="ident">env</span> <span class="op">=</span> <span class="ident">cx</span>.<span class="ident">env</span>();
        <span class="kw">unsafe</span> {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">local</span>: <span class="ident">raw::Local</span> <span class="op">=</span> <span class="ident">std::mem::zeroed</span>();
            <span class="ident">neon_runtime::call::this</span>(<span class="ident">env</span>.<span class="ident">to_raw</span>(), <span class="ident">std::mem::transmute</span>(<span class="self">self</span>.<span class="ident">info</span>), <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">local</span>);
            <span class="ident">local</span>
        }
    }
}

<span class="doccomment">/// Indicates whether a function was called with `new`.</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Copy</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">CallKind</span> {
    <span class="ident">Construct</span>,
    <span class="ident">Call</span>,
}

<span class="doccomment">/// A temporary lock of an execution context.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// While a lock is alive, no JavaScript code can be executed in the execution context.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Objects that support the `Borrow` and `BorrowMut` traits can be inspected while the context is locked by passing a reference to a `Lock` to their methods.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Lock</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">ledger</span>: <span class="ident">RefCell</span><span class="op">&lt;</span><span class="ident">Ledger</span><span class="op">&gt;</span>,
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="ident">env</span>: <span class="ident">Env</span>,
    <span class="ident">phantom</span>: <span class="ident">PhantomData</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> ()<span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">Lock</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">new</span>(<span class="ident">env</span>: <span class="ident">Env</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="self">Self</span> {
        <span class="ident">Lock</span> {
            <span class="ident">ledger</span>: <span class="ident">RefCell::new</span>(<span class="ident">Ledger::new</span>()),
            <span class="ident">env</span>,
            <span class="ident">phantom</span>: <span class="ident">PhantomData</span>,
        }
    }
}

<span class="doccomment">/// An _execution context_, which represents the current state of a thread of execution in the JavaScript engine.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// All interaction with the JavaScript engine in Neon code is mediated through instances of this trait.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// A context has a lifetime `&#39;a`, which ensures the safety of handles managed by the JS garbage collector. All handles created during the lifetime of a context are kept alive for that duration and cannot outlive the context.</span>
<span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span>: <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="doccomment">/// Lock the JavaScript engine, returning an RAII guard that keeps the lock active as long as the guard is alive.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// If this is not the currently active context (for example, if it was used to spawn a scoped context with `execute_scoped` or `compute_scoped`), this method will panic.</span>
    <span class="kw">fn</span> <span class="ident">lock</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Lock</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">check_active</span>();
        <span class="ident">Lock::new</span>(<span class="self">self</span>.<span class="ident">env</span>())
    }

    <span class="doccomment">/// Convenience method for locking the JavaScript engine and borrowing a single JS value&#39;s internals.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Example:</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ```no_run</span>
    <span class="doccomment">/// # use neon::prelude::*;</span>
    <span class="doccomment">/// # fn my_neon_function(mut cx: FunctionContext) -&gt; JsResult&lt;JsNumber&gt; {</span>
    <span class="doccomment">/// let b: Handle&lt;JsArrayBuffer&gt; = cx.argument(0)?;</span>
    <span class="doccomment">/// let x: u32 = cx.borrow(&amp;b, |data| { data.as_slice()[0] });</span>
    <span class="doccomment">/// let n: Handle&lt;JsNumber&gt; = cx.number(x);</span>
    <span class="doccomment">/// # Ok(n)</span>
    <span class="doccomment">/// # }</span>
    <span class="doccomment">/// ```</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// Note: the borrowed value is required to be a reference to a handle instead of a handle</span>
    <span class="doccomment">/// as a workaround for a [Rust compiler bug](https://github.com/rust-lang/rust/issues/29997).</span>
    <span class="doccomment">/// We may be able to generalize this compatibly in the future when the Rust bug is fixed,</span>
    <span class="doccomment">/// but while the extra `&amp;` is a small ergonomics regression, this API is still a nice</span>
    <span class="doccomment">/// convenience.</span>
    <span class="kw">fn</span> <span class="ident">borrow</span><span class="op">&lt;</span><span class="lifetime">&#39;c</span>, <span class="ident">V</span>, <span class="ident">T</span>, <span class="ident">F</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">v</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;c</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="ident">V</span><span class="op">&gt;</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span>
    <span class="kw">where</span>
        <span class="ident">V</span>: <span class="ident">Value</span>,
        <span class="kw-2">&amp;</span><span class="lifetime">&#39;c</span> <span class="ident">V</span>: <span class="ident">Borrow</span>,
        <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">Ref</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;c</span> <span class="ident">V</span> <span class="kw">as</span> <span class="ident">Borrow</span><span class="op">&gt;</span><span class="ident">::Target</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span>,
    {
        <span class="kw">let</span> <span class="ident">lock</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">lock</span>();
        <span class="kw">let</span> <span class="ident">contents</span> <span class="op">=</span> <span class="ident">v</span>.<span class="ident">borrow</span>(<span class="kw-2">&amp;</span><span class="ident">lock</span>);
        <span class="ident">f</span>(<span class="ident">contents</span>)
    }

    <span class="doccomment">/// Convenience method for locking the JavaScript engine and mutably borrowing a single JS value&#39;s internals.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Example:</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ```no_run</span>
    <span class="doccomment">/// # use neon::prelude::*;</span>
    <span class="doccomment">/// # fn my_neon_function(mut cx: FunctionContext) -&gt; JsResult&lt;JsUndefined&gt; {</span>
    <span class="doccomment">/// let mut b: Handle&lt;JsArrayBuffer&gt; = cx.argument(0)?;</span>
    <span class="doccomment">/// cx.borrow_mut(&amp;mut b, |data| {</span>
    <span class="doccomment">///     let slice = data.as_mut_slice::&lt;u32&gt;();</span>
    <span class="doccomment">///     slice[0] += 1;</span>
    <span class="doccomment">/// });</span>
    <span class="doccomment">/// # Ok(cx.undefined())</span>
    <span class="doccomment">/// # }</span>
    <span class="doccomment">/// ```</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// Note: the borrowed value is required to be a reference to a handle instead of a handle</span>
    <span class="doccomment">/// as a workaround for a [Rust compiler bug](https://github.com/rust-lang/rust/issues/29997).</span>
    <span class="doccomment">/// We may be able to generalize this compatibly in the future when the Rust bug is fixed,</span>
    <span class="doccomment">/// but while the extra `&amp;mut` is a small ergonomics regression, this API is still a nice</span>
    <span class="doccomment">/// convenience.</span>
    <span class="kw">fn</span> <span class="ident">borrow_mut</span><span class="op">&lt;</span><span class="lifetime">&#39;c</span>, <span class="ident">V</span>, <span class="ident">T</span>, <span class="ident">F</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">v</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;c</span> <span class="kw-2">mut</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="ident">V</span><span class="op">&gt;</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span>
    <span class="kw">where</span>
        <span class="ident">V</span>: <span class="ident">Value</span>,
        <span class="kw-2">&amp;</span><span class="lifetime">&#39;c</span> <span class="kw-2">mut</span> <span class="ident">V</span>: <span class="ident">BorrowMut</span>,
        <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">RefMut</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;c</span> <span class="kw-2">mut</span> <span class="ident">V</span> <span class="kw">as</span> <span class="ident">Borrow</span><span class="op">&gt;</span><span class="ident">::Target</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span>,
    {
        <span class="kw">let</span> <span class="ident">lock</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">lock</span>();
        <span class="kw">let</span> <span class="ident">contents</span> <span class="op">=</span> <span class="ident">v</span>.<span class="ident">borrow_mut</span>(<span class="kw-2">&amp;</span><span class="ident">lock</span>);
        <span class="ident">f</span>(<span class="ident">contents</span>)
    }

    <span class="doccomment">/// Executes a computation in a new memory management scope.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// Handles created in the new scope are kept alive only for the duration of the computation and cannot escape.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// This method can be useful for limiting the life of temporary values created during long-running computations, to prevent leaks.</span>
    <span class="kw">fn</span> <span class="ident">execute_scoped</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">F</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span>
    <span class="kw">where</span>
        <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">ExecuteContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span>,
    {
        <span class="self">self</span>.<span class="ident">check_active</span>();
        <span class="self">self</span>.<span class="ident">deactivate</span>();
        <span class="kw">let</span> <span class="ident">result</span> <span class="op">=</span> <span class="ident">ExecuteContext::with</span>(<span class="self">self</span>, <span class="ident">f</span>);
        <span class="self">self</span>.<span class="ident">activate</span>();
        <span class="ident">result</span>
    }

    <span class="doccomment">/// Executes a computation in a new memory management scope and computes a single result value that outlives the computation.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// Handles created in the new scope are kept alive only for the duration of the computation and cannot escape, with the exception of the result value, which is rooted in the outer context.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// This method can be useful for limiting the life of temporary values created during long-running computations, to prevent leaks.</span>
    <span class="kw">fn</span> <span class="ident">compute_scoped</span><span class="op">&lt;</span><span class="ident">V</span>, <span class="ident">F</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">V</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">V</span>: <span class="ident">Value</span>,
        <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="lifetime">&#39;c</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">ComputeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="lifetime">&#39;c</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">V</span><span class="op">&gt;</span>,
    {
        <span class="self">self</span>.<span class="ident">check_active</span>();
        <span class="self">self</span>.<span class="ident">deactivate</span>();
        <span class="kw">let</span> <span class="ident">result</span> <span class="op">=</span> <span class="ident">ComputeContext::with</span>(<span class="self">self</span>, <span class="op">|</span><span class="ident">cx</span><span class="op">|</span> <span class="kw">unsafe</span> {
            <span class="kw">let</span> <span class="ident">escapable_handle_scope</span> <span class="op">=</span> <span class="ident">cx</span>.<span class="ident">scope</span>.<span class="ident">handle_scope</span> <span class="kw">as</span> <span class="kw-2">*</span><span class="kw-2">mut</span> <span class="ident">raw::EscapableHandleScope</span>;
            <span class="kw">let</span> <span class="ident">escapee</span> <span class="op">=</span> <span class="ident">f</span>(<span class="ident">cx</span>)<span class="question-mark">?</span>;
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">result_local</span>: <span class="ident">raw::Local</span> <span class="op">=</span> <span class="ident">std::mem::zeroed</span>();
            <span class="ident">neon_runtime::scope::escape</span>(
                <span class="self">self</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(),
                <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">result_local</span>,
                <span class="ident">escapable_handle_scope</span>,
                <span class="ident">escapee</span>.<span class="ident">to_raw</span>(),
            );
            <span class="prelude-val">Ok</span>(<span class="ident">Handle::new_internal</span>(<span class="ident">V::from_raw</span>(<span class="self">self</span>.<span class="ident">env</span>(), <span class="ident">result_local</span>)))
        });
        <span class="self">self</span>.<span class="ident">activate</span>();
        <span class="ident">result</span>
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;try-catch-api&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">cfg_attr</span>(<span class="ident">docsrs</span>, <span class="ident">doc</span>(<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;try-catch-api&quot;</span>)))]</span>
    <span class="kw">fn</span> <span class="ident">try_catch</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">F</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsValue</span><span class="op">&gt;</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">F</span>: <span class="ident">FnOnce</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">Self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>,
    {
        <span class="self">self</span>.<span class="ident">try_catch_internal</span>(<span class="ident">f</span>)
    }

    <span class="doccomment">/// Convenience method for creating a `JsBoolean` value.</span>
    <span class="kw">fn</span> <span class="ident">boolean</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">b</span>: <span class="ident">bool</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsBoolean</span><span class="op">&gt;</span> {
        <span class="ident">JsBoolean::new</span>(<span class="self">self</span>, <span class="ident">b</span>)
    }

    <span class="doccomment">/// Convenience method for creating a `JsNumber` value.</span>
    <span class="kw">fn</span> <span class="ident">number</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">Into</span><span class="op">&lt;</span><span class="ident">f64</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">x</span>: <span class="ident">T</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsNumber</span><span class="op">&gt;</span> {
        <span class="ident">JsNumber::new</span>(<span class="self">self</span>, <span class="ident">x</span>.<span class="ident">into</span>())
    }

    <span class="doccomment">/// Convenience method for creating a `JsString` value.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// If the string exceeds the limits of the JS engine, this method panics.</span>
    <span class="kw">fn</span> <span class="ident">string</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">s</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsString</span><span class="op">&gt;</span> {
        <span class="ident">JsString::new</span>(<span class="self">self</span>, <span class="ident">s</span>)
    }

    <span class="doccomment">/// Convenience method for creating a `JsString` value.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// If the string exceeds the limits of the JS engine, this method returns an `Err` value.</span>
    <span class="kw">fn</span> <span class="ident">try_string</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">s</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">StringResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
        <span class="ident">JsString::try_new</span>(<span class="self">self</span>, <span class="ident">s</span>)
    }

    <span class="doccomment">/// Convenience method for creating a `JsNull` value.</span>
    <span class="kw">fn</span> <span class="ident">null</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsNull</span><span class="op">&gt;</span> {
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
        <span class="kw">return</span> <span class="ident">JsNull::new</span>();
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
        <span class="kw">return</span> <span class="ident">JsNull::new</span>(<span class="self">self</span>);
    }

    <span class="doccomment">/// Convenience method for creating a `JsUndefined` value.</span>
    <span class="kw">fn</span> <span class="ident">undefined</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsUndefined</span><span class="op">&gt;</span> {
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
        <span class="kw">return</span> <span class="ident">JsUndefined::new</span>();
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
        <span class="kw">return</span> <span class="ident">JsUndefined::new</span>(<span class="self">self</span>);
    }

    <span class="doccomment">/// Convenience method for creating an empty `JsObject` value.</span>
    <span class="kw">fn</span> <span class="ident">empty_object</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsObject</span><span class="op">&gt;</span> {
        <span class="ident">JsObject::new</span>(<span class="self">self</span>)
    }

    <span class="doccomment">/// Convenience method for creating an empty `JsArray` value.</span>
    <span class="kw">fn</span> <span class="ident">empty_array</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsArray</span><span class="op">&gt;</span> {
        <span class="ident">JsArray::new</span>(<span class="self">self</span>, <span class="number">0</span>)
    }

    <span class="doccomment">/// Convenience method for creating an empty `JsArrayBuffer` value.</span>
    <span class="kw">fn</span> <span class="ident">array_buffer</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">size</span>: <span class="ident">u32</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsArrayBuffer</span><span class="op">&gt;</span> {
        <span class="ident">JsArrayBuffer::new</span>(<span class="self">self</span>, <span class="ident">size</span>)
    }

    <span class="doccomment">/// Convenience method for creating an empty `JsBuffer` value.</span>
    <span class="kw">fn</span> <span class="ident">buffer</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">size</span>: <span class="ident">u32</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsBuffer</span><span class="op">&gt;</span> {
        <span class="ident">JsBuffer::new</span>(<span class="self">self</span>, <span class="ident">size</span>)
    }

    <span class="doccomment">/// Convenience method for creating a `JsDate` value.</span>
    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-5&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">cfg_attr</span>(<span class="ident">docsrs</span>, <span class="ident">doc</span>(<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-5&quot;</span>)))]</span>
    <span class="kw">fn</span> <span class="ident">date</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">value</span>: <span class="kw">impl</span> <span class="ident">Into</span><span class="op">&lt;</span><span class="ident">f64</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsDate</span><span class="op">&gt;</span>, <span class="ident">DateError</span><span class="op">&gt;</span> {
        <span class="ident">JsDate::new</span>(<span class="self">self</span>, <span class="ident">value</span>)
    }

    <span class="doccomment">/// Produces a handle to the JavaScript global object.</span>
    <span class="kw">fn</span> <span class="ident">global</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsObject</span><span class="op">&gt;</span> {
        <span class="ident">JsObject::build</span>(<span class="op">|</span><span class="ident">out</span><span class="op">|</span> <span class="kw">unsafe</span> {
            <span class="ident">neon_runtime::scope::get_global</span>(<span class="self">self</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(), <span class="ident">out</span>);
        })
    }

    <span class="doccomment">/// Throws a JS value.</span>
    <span class="kw">fn</span> <span class="ident">throw</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">Value</span>, <span class="ident">U</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">v</span>: <span class="ident">Handle</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span><span class="ident">U</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> {
            <span class="ident">neon_runtime::error::throw</span>(<span class="self">self</span>.<span class="ident">env</span>().<span class="ident">to_raw</span>(), <span class="ident">v</span>.<span class="ident">to_raw</span>());
        }
        <span class="prelude-val">Err</span>(<span class="ident">Throw</span>)
    }

    <span class="doccomment">/// Creates a direct instance of the [`Error`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error) class.</span>
    <span class="kw">fn</span> <span class="ident">error</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsError</span><span class="op">&gt;</span> {
        <span class="ident">JsError::error</span>(<span class="self">self</span>, <span class="ident">msg</span>)
    }

    <span class="doccomment">/// Creates an instance of the [`TypeError`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypeError) class.</span>
    <span class="kw">fn</span> <span class="ident">type_error</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsError</span><span class="op">&gt;</span> {
        <span class="ident">JsError::type_error</span>(<span class="self">self</span>, <span class="ident">msg</span>)
    }

    <span class="doccomment">/// Creates an instance of the [`RangeError`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RangeError) class.</span>
    <span class="kw">fn</span> <span class="ident">range_error</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsError</span><span class="op">&gt;</span> {
        <span class="ident">JsError::range_error</span>(<span class="self">self</span>, <span class="ident">msg</span>)
    }

    <span class="doccomment">/// Throws a direct instance of the [`Error`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error) class.</span>
    <span class="kw">fn</span> <span class="ident">throw_error</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">err</span> <span class="op">=</span> <span class="ident">JsError::error</span>(<span class="self">self</span>, <span class="ident">msg</span>)<span class="question-mark">?</span>;
        <span class="self">self</span>.<span class="ident">throw</span>(<span class="ident">err</span>)
    }

    <span class="doccomment">/// Throws an instance of the [`TypeError`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypeError) class.</span>
    <span class="kw">fn</span> <span class="ident">throw_type_error</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">err</span> <span class="op">=</span> <span class="ident">JsError::type_error</span>(<span class="self">self</span>, <span class="ident">msg</span>)<span class="question-mark">?</span>;
        <span class="self">self</span>.<span class="ident">throw</span>(<span class="ident">err</span>)
    }

    <span class="doccomment">/// Throws an instance of the [`RangeError`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RangeError) class.</span>
    <span class="kw">fn</span> <span class="ident">throw_range_error</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="ident">AsRef</span><span class="op">&lt;</span><span class="ident">str</span><span class="op">&gt;</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">S</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">err</span> <span class="op">=</span> <span class="ident">JsError::range_error</span>(<span class="self">self</span>, <span class="ident">msg</span>)<span class="question-mark">?</span>;
        <span class="self">self</span>.<span class="ident">throw</span>(<span class="ident">err</span>)
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
    <span class="doccomment">/// Convenience method for wrapping a value in a `JsBox`.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Example:</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// ```rust</span>
    <span class="doccomment">/// # use neon::prelude::*;</span>
    <span class="doccomment">/// struct Point(usize, usize);</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// impl Finalize for Point {}</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// fn my_neon_function(mut cx: FunctionContext) -&gt; JsResult&lt;JsBox&lt;Point&gt;&gt; {</span>
    <span class="doccomment">///     let point = cx.boxed(Point(0, 1));</span>
    <span class="doccomment">///</span>
    <span class="doccomment">///     Ok(point)</span>
    <span class="doccomment">/// }</span>
    <span class="doccomment">/// ```</span>
    <span class="kw">fn</span> <span class="ident">boxed</span><span class="op">&lt;</span><span class="ident">U</span>: <span class="ident">Finalize</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">v</span>: <span class="ident">U</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsBox</span><span class="op">&lt;</span><span class="ident">U</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="ident">JsBox::new</span>(<span class="self">self</span>, <span class="ident">v</span>)
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-4&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;channel-api&quot;</span>))]</span>
    <span class="attribute">#[<span class="ident">cfg_attr</span>(<span class="ident">docsrs</span>, <span class="ident">doc</span>(<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-4&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;channel-api&quot;</span>))))]</span>
    <span class="doccomment">/// Returns an unbounded channel for scheduling events to be executed on the JavaScript thread.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// When using N-API &gt;= 6,the channel returned by this method is backed by a shared queue.</span>
    <span class="doccomment">/// To create a channel backed by a _new_ queue see [`Channel`](crate::event::Channel).</span>
    <span class="kw">fn</span> <span class="ident">channel</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Channel</span> {
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-6&quot;</span>)]</span>
        <span class="kw">let</span> <span class="ident">channel</span> <span class="op">=</span> <span class="ident">InstanceData::channel</span>(<span class="self">self</span>);

        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">not</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-6&quot;</span>))]</span>
        <span class="kw">let</span> <span class="ident">channel</span> <span class="op">=</span> <span class="ident">Channel::new</span>(<span class="self">self</span>);

        <span class="ident">channel</span>
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-4&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;channel-api&quot;</span>))]</span>
    <span class="attribute">#[<span class="ident">deprecated</span>(<span class="ident">since</span> <span class="op">=</span> <span class="string">&quot;0.9.0&quot;</span>, <span class="ident">note</span> <span class="op">=</span> <span class="string">&quot;Please use the channel() method instead&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
    <span class="kw">fn</span> <span class="ident">queue</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Channel</span> {
        <span class="self">self</span>.<span class="ident">channel</span>()
    }
}

<span class="doccomment">/// An execution context of module initialization.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ModuleContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="ident">scope</span>: <span class="ident">Scope</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">raw::HandleScope</span><span class="op">&gt;</span>,
    <span class="ident">exports</span>: <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsObject</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">UnwindSafe</span> <span class="kw">for</span> <span class="ident">ModuleContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">ModuleContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">ModuleContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span><span class="op">&gt;</span>(
        <span class="ident">env</span>: <span class="ident">Env</span>,
        <span class="ident">exports</span>: <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsObject</span><span class="op">&gt;</span>,
        <span class="ident">f</span>: <span class="ident">F</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span> {
        <span class="comment">// These assertions ensure the proper amount of space is reserved on the rust stack</span>
        <span class="comment">// This is only necessary in the legacy runtime.</span>
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
        {
            <span class="macro">debug_assert!</span>(
                <span class="kw">unsafe</span> { <span class="ident">neon_runtime::scope::size</span>() } <span class="op">&lt;</span><span class="op">=</span> <span class="ident">std::mem::size_of</span>::<span class="op">&lt;</span><span class="ident">raw::HandleScope</span><span class="op">&gt;</span>()
            );
            <span class="macro">debug_assert!</span>(
                <span class="kw">unsafe</span> { <span class="ident">neon_runtime::scope::alignment</span>() }
                    <span class="op">&lt;</span><span class="op">=</span> <span class="ident">std::mem::align_of</span>::<span class="op">&lt;</span><span class="ident">raw::HandleScope</span><span class="op">&gt;</span>()
            );
        }
        <span class="ident">Scope::with</span>(<span class="ident">env</span>, <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> <span class="ident">f</span>(<span class="ident">ModuleContext</span> { <span class="ident">scope</span>, <span class="ident">exports</span> }))
    }

    <span class="doccomment">/// Convenience method for exporting a Neon function from a module.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">export_function</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">Value</span><span class="op">&gt;</span>(
        <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>,
        <span class="ident">key</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>,
        <span class="ident">f</span>: <span class="kw">fn</span>(<span class="ident">FunctionContext</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">value</span> <span class="op">=</span> <span class="ident">JsFunction::new</span>(<span class="self">self</span>, <span class="ident">f</span>)<span class="question-mark">?</span>.<span class="ident">upcast</span>::<span class="op">&lt;</span><span class="ident">JsValue</span><span class="op">&gt;</span>();
        <span class="self">self</span>.<span class="ident">exports</span>.<span class="ident">set</span>(<span class="self">self</span>, <span class="ident">key</span>, <span class="ident">value</span>)<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(())
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
    <span class="doccomment">/// Convenience method for exporting a Neon class constructor from a module.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">export_class</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">Class</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">key</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">constructor</span> <span class="op">=</span> <span class="ident">T::constructor</span>(<span class="self">self</span>)<span class="question-mark">?</span>;
        <span class="self">self</span>.<span class="ident">exports</span>.<span class="ident">set</span>(<span class="self">self</span>, <span class="ident">key</span>, <span class="ident">constructor</span>)<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Exports a JavaScript value from a Neon module.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">export_value</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">Value</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">key</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>, <span class="ident">val</span>: <span class="ident">Handle</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">NeonResult</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">exports</span>.<span class="ident">set</span>(<span class="self">self</span>, <span class="ident">key</span>, <span class="ident">val</span>)<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Produces a handle to a module&#39;s exports object.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">exports_object</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsObject</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(<span class="self">self</span>.<span class="ident">exports</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">ModuleContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">scope_metadata</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">ScopeMetadata</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">scope</span>.<span class="ident">metadata</span>
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">ModuleContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {}

<span class="doccomment">/// An execution context of a scope created by [`Context::execute_scoped()`](Context::execute_scoped).</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ExecuteContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="ident">scope</span>: <span class="ident">Scope</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">raw::HandleScope</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">ExecuteContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">ExecuteContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span><span class="op">&gt;</span>(
        <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="ident">C</span>,
        <span class="ident">f</span>: <span class="ident">F</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span> {
        <span class="ident">Scope::with</span>(<span class="ident">cx</span>.<span class="ident">env</span>(), <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> <span class="ident">f</span>(<span class="ident">ExecuteContext</span> { <span class="ident">scope</span> }))
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">ExecuteContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">scope_metadata</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">ScopeMetadata</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">scope</span>.<span class="ident">metadata</span>
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">ExecuteContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {}

<span class="doccomment">/// An execution context of a scope created by [`Context::compute_scoped()`](Context::compute_scoped).</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ComputeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;outer</span><span class="op">&gt;</span> {
    <span class="ident">scope</span>: <span class="ident">Scope</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">raw::EscapableHandleScope</span><span class="op">&gt;</span>,
    <span class="ident">phantom_inner</span>: <span class="ident">PhantomData</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> ()<span class="op">&gt;</span>,
    <span class="ident">phantom_outer</span>: <span class="ident">PhantomData</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;outer</span> ()<span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">ComputeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;b</span><span class="op">&gt;</span> {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">C</span>: <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;c</span>, <span class="lifetime">&#39;d</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">ComputeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;c</span>, <span class="lifetime">&#39;d</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span><span class="op">&gt;</span>(
        <span class="ident">cx</span>: <span class="kw-2">&amp;</span><span class="ident">C</span>,
        <span class="ident">f</span>: <span class="ident">F</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span> {
        <span class="ident">Scope::with</span>(<span class="ident">cx</span>.<span class="ident">env</span>(), <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> {
            <span class="ident">f</span>(<span class="ident">ComputeContext</span> {
                <span class="ident">scope</span>,
                <span class="ident">phantom_inner</span>: <span class="ident">PhantomData</span>,
                <span class="ident">phantom_outer</span>: <span class="ident">PhantomData</span>,
            })
        })
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">ComputeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;b</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">scope_metadata</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">ScopeMetadata</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">scope</span>.<span class="ident">metadata</span>
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">ComputeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="lifetime">&#39;b</span><span class="op">&gt;</span> {}

<span class="doccomment">/// An execution context of a function call.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// The type parameter `T` is the type of the `this`-binding.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span>: <span class="ident">This</span><span class="op">&gt;</span> {
    <span class="ident">scope</span>: <span class="ident">Scope</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">raw::HandleScope</span><span class="op">&gt;</span>,
    <span class="ident">info</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> <span class="ident">CallbackInfo</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span>,
    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
    <span class="ident">arguments</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">SmallVec</span><span class="op">&lt;</span>[<span class="ident">raw::Local</span>; <span class="number">8</span>]<span class="op">&gt;</span><span class="op">&gt;</span>,
    <span class="ident">phantom_type</span>: <span class="ident">PhantomData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span>: <span class="ident">This</span><span class="op">&gt;</span> <span class="ident">UnwindSafe</span> <span class="kw">for</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span>: <span class="ident">This</span><span class="op">&gt;</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="doccomment">/// Indicates whether the function was called with `new`.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">kind</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">CallKind</span> {
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
        <span class="kw">let</span> <span class="ident">kind</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">info</span>.<span class="ident">kind</span>();

        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
        <span class="kw">let</span> <span class="ident">kind</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">info</span>.<span class="ident">kind</span>(<span class="self">self</span>);

        <span class="ident">kind</span>
    }

    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with</span><span class="op">&lt;</span><span class="ident">U</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span>, <span class="ident">T</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">U</span><span class="op">&gt;</span>(
        <span class="ident">env</span>: <span class="ident">Env</span>,
        <span class="ident">info</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> <span class="ident">CallbackInfo</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span>,
        <span class="ident">f</span>: <span class="ident">F</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">U</span> {
        <span class="ident">Scope::with</span>(<span class="ident">env</span>, <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> {
            <span class="ident">f</span>(<span class="ident">CallContext</span> {
                <span class="ident">scope</span>,
                <span class="ident">info</span>,
                <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
                <span class="ident">arguments</span>: <span class="prelude-val">None</span>,
                <span class="ident">phantom_type</span>: <span class="ident">PhantomData</span>,
            })
        })
    }

    <span class="doccomment">/// Indicates the number of arguments that were passed to the function.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">len</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">i32</span> {
        <span class="self">self</span>.<span class="ident">info</span>.<span class="ident">len</span>(<span class="self">self</span>)
    }

    <span class="doccomment">/// Indicates if no arguments were passed to the function.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">is_empty</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">bool</span> {
        <span class="self">self</span>.<span class="ident">len</span>() <span class="op">=</span><span class="op">=</span> <span class="number">0</span>
    }

    <span class="doccomment">/// Produces the `i`th argument, or `None` if `i` is greater than or equal to `self.len()`.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">argument_opt</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">i</span>: <span class="ident">i32</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsValue</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
        {
            <span class="self">self</span>.<span class="ident">info</span>.<span class="ident">get</span>(<span class="self">self</span>, <span class="ident">i</span>)
        }

        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
        {
            <span class="kw">let</span> <span class="ident">local</span> <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>(<span class="ident">arguments</span>) <span class="op">=</span> <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">arguments</span> {
                <span class="ident">arguments</span>.<span class="ident">get</span>(<span class="ident">i</span> <span class="kw">as</span> <span class="ident">usize</span>).<span class="ident">cloned</span>()
            } <span class="kw">else</span> {
                <span class="kw">let</span> <span class="ident">arguments</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">info</span>.<span class="ident">argv</span>(<span class="self">self</span>);
                <span class="kw">let</span> <span class="ident">local</span> <span class="op">=</span> <span class="ident">arguments</span>.<span class="ident">get</span>(<span class="ident">i</span> <span class="kw">as</span> <span class="ident">usize</span>).<span class="ident">cloned</span>();

                <span class="self">self</span>.<span class="ident">arguments</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="ident">arguments</span>);
                <span class="ident">local</span>
            };

            <span class="ident">local</span>.<span class="ident">map</span>(<span class="op">|</span><span class="ident">local</span><span class="op">|</span> <span class="ident">Handle::new_internal</span>(<span class="ident">JsValue::from_raw</span>(<span class="self">self</span>.<span class="ident">env</span>(), <span class="ident">local</span>)))
        }
    }

    <span class="doccomment">/// Produces the `i`th argument and casts it to the type `V`, or throws an exception if `i` is greater than or equal to `self.len()` or cannot be cast to `V`.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">argument</span><span class="op">&lt;</span><span class="ident">V</span>: <span class="ident">Value</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>, <span class="ident">i</span>: <span class="ident">i32</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">JsResult</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">V</span><span class="op">&gt;</span> {
        <span class="kw">match</span> <span class="self">self</span>.<span class="ident">argument_opt</span>(<span class="ident">i</span>) {
            <span class="prelude-val">Some</span>(<span class="ident">v</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="ident">v</span>.<span class="ident">downcast_or_throw</span>(<span class="self">self</span>),
            <span class="prelude-val">None</span> <span class="op">=</span><span class="op">&gt;</span> <span class="self">self</span>.<span class="ident">throw_type_error</span>(<span class="string">&quot;not enough arguments&quot;</span>),
        }
    }

    <span class="doccomment">/// Produces a handle to the `this`-binding.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">this</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Handle</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span> {
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
        <span class="kw">let</span> <span class="ident">this</span> <span class="op">=</span> <span class="ident">T::as_this</span>(<span class="self">self</span>.<span class="ident">info</span>.<span class="ident">this</span>(<span class="self">self</span>));
        <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
        <span class="kw">let</span> <span class="ident">this</span> <span class="op">=</span> <span class="ident">T::as_this</span>(<span class="self">self</span>.<span class="ident">env</span>(), <span class="self">self</span>.<span class="ident">info</span>.<span class="ident">this</span>(<span class="self">self</span>));

        <span class="ident">Handle::new_internal</span>(<span class="ident">this</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span>: <span class="ident">This</span><span class="op">&gt;</span> <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">scope_metadata</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">ScopeMetadata</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">scope</span>.<span class="ident">metadata</span>
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span>: <span class="ident">This</span><span class="op">&gt;</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// A shorthand for a [`CallContext`](CallContext) with `this`-type [`JsObject`](crate::types::JsObject).</span>
<span class="kw">pub</span> <span class="kw">type</span> <span class="ident">FunctionContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">JsObject</span><span class="op">&gt;</span>;

<span class="doccomment">/// An alias for [`CallContext`](CallContext), useful for indicating that the function is a method of a class.</span>
<span class="kw">pub</span> <span class="kw">type</span> <span class="ident">MethodContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">CallContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">T</span><span class="op">&gt;</span>;

<span class="doccomment">/// An execution context of a task completion callback.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">TaskContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="doccomment">/// We use an &quot;inherited HandleScope&quot; here because the C++ `neon::Task::complete`</span>
    <span class="doccomment">/// method sets up and tears down a `HandleScope` for us.</span>
    <span class="ident">scope</span>: <span class="ident">Scope</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">raw::InheritedHandleScope</span><span class="op">&gt;</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">TaskContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;legacy-runtime&quot;</span>)]</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">TaskContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span> {
        <span class="kw">let</span> <span class="ident">env</span> <span class="op">=</span> <span class="ident">Env::current</span>();
        <span class="ident">Scope::with</span>(<span class="ident">env</span>, <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> <span class="ident">f</span>(<span class="ident">TaskContext</span> { <span class="ident">scope</span> }))
    }

    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-4&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;channel-api&quot;</span>))]</span>
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with_context</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">TaskContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">env</span>: <span class="ident">Env</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span> {
        <span class="ident">Scope::with</span>(<span class="ident">env</span>, <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> <span class="ident">f</span>(<span class="ident">TaskContext</span> { <span class="ident">scope</span> }))
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">TaskContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">scope_metadata</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">ScopeMetadata</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">scope</span>.<span class="ident">metadata</span>
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">TaskContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {}

<span class="doccomment">/// A view of the JS engine in the context of a finalize method on garbage collection</span>
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
<span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">struct</span> <span class="ident">FinalizeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="ident">scope</span>: <span class="ident">Scope</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span>, <span class="ident">raw::HandleScope</span><span class="op">&gt;</span>,
}

<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">FinalizeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn</span> <span class="ident">with</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">F</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>(<span class="ident">FinalizeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;b</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">env</span>: <span class="ident">Env</span>, <span class="ident">f</span>: <span class="ident">F</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">T</span> {
        <span class="ident">Scope::with</span>(<span class="ident">env</span>, <span class="op">|</span><span class="ident">scope</span><span class="op">|</span> <span class="ident">f</span>(<span class="ident">FinalizeContext</span> { <span class="ident">scope</span> }))
    }
}

<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">ContextInternal</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">FinalizeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">scope_metadata</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">ScopeMetadata</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">scope</span>.<span class="ident">metadata</span>
    }
}

<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;napi-1&quot;</span>)]</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="ident">Context</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">FinalizeContext</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {}
</pre></div>
</section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="neon" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div><script src="../../../main.js"></script><script src="../../../source-script.js"></script><script src="../../../source-files.js"></script></body></html>